RewriteEngine On
RewriteRule .* - [E=AUTH_REQUIRED:true]
RewriteCond %{REQUEST_METHOD} ^(GET)$
RewriteRule .* - [E=AUTH_REQUIRED:false]

<If "env('AUTH_REQUIRED') == 'true'">
  AuthType Basic
  AuthName "Authentication required to write"
  AuthUserFile /htpasswd
  Require valid-user
</If>

ProxyPass / http://${GATEWAY}/
ProxyPassReverse / http://${GATEWAY}/
